<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom RR RPC Patcher</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState } = React;

        // Lucide icons as inline SVG components
        const Upload = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const Download = ({ size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const HelpCircle = ({ size = 16, className = "", onClick, title }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} onClick={onClick} title={title}>
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
        );

        function HexPatcher() {
            const [file, setFile] = useState(null);
            const [fileName, setFileName] = useState('');
            const [appId, setAppId] = useState('');
            const [status, setStatus] = useState('');
            const [dragActive, setDragActive] = useState(false);
            const [showHelp, setShowHelp] = useState(false);

            const TARGET_HEX = '31 33 34 31 32 34 33 30 30 35 31 37 36 33 38 35 35 37 38';

            const handleDrag = (e) => {
                e.preventDefault();
                e.stopPropagation();
                if (e.type === 'dragenter' || e.type === 'dragover') {
                    setDragActive(true);
                } else if (e.type === 'dragleave') {
                    setDragActive(false);
                }
            };

            const handleDrop = (e) => {
                e.preventDefault();
                e.stopPropagation();
                setDragActive(false);
                
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    handleFile(e.dataTransfer.files[0]);
                }
            };

            const handleFileInput = (e) => {
                if (e.target.files && e.target.files[0]) {
                    handleFile(e.target.files[0]);
                }
            };

            const handleFile = (uploadedFile) => {
                setFileName(uploadedFile.name);
                const reader = new FileReader();
                reader.onload = (e) => {
                    const arrayBuffer = e.target.result;
                    const uint8Array = new Uint8Array(arrayBuffer);
                    
                    // Convert to hex string for detection
                    const hexString = Array.from(uint8Array)
                        .map(byte => byte.toString(16).padStart(2, '0').toUpperCase())
                        .join(' ');
                    
                    if (hexString.includes(TARGET_HEX)) {
                        setStatus('');
                        setFile(uint8Array);
                    } else {
                        setStatus('Custom RPC already applied');
                        setFile(uint8Array);
                    }
                };
                reader.readAsArrayBuffer(uploadedFile);
            };

            const handleAppIdChange = (e) => {
                const value = e.target.value.replace(/\D/g, '');
                setAppId(value);
            };

            const convertToHex = (appIdString) => {
                return appIdString.split('').map(digit => '3' + digit).join(' ');
            };

            const handlePatch = () => {
                if (!file) {
                    setStatus('Please upload a file first');
                    return;
                }
                if (!appId) {
                    setStatus('Please enter an Application ID');
                    return;
                }

                const newHexString = convertToHex(appId);
                const targetBytes = TARGET_HEX.split(' ').map(hex => parseInt(hex, 16));
                const newBytes = newHexString.split(' ').map(hex => parseInt(hex, 16));

                // Create a copy of the file
                const patchedFile = new Uint8Array(file);

                // Find and replace all occurrences
                let replacements = 0;
                for (let i = 0; i <= patchedFile.length - targetBytes.length; i++) {
                    let match = true;
                    for (let j = 0; j < targetBytes.length; j++) {
                        if (patchedFile[i + j] !== targetBytes[j]) {
                            match = false;
                            break;
                        }
                    }
                    if (match) {
                        for (let j = 0; j < newBytes.length && i + j < patchedFile.length; j++) {
                            patchedFile[i + j] = newBytes[j];
                        }
                        replacements++;
                        i += targetBytes.length - 1;
                    }
                }

                if (replacements > 0) {
                    // Create download
                    const blob = new Blob([patchedFile], { type: 'application/octet-stream' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = fileName || 'Code_patched.pul';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    setStatus(`Patched RPC and downloaded file`);
                } else {
                    setStatus('Custom RPC already applied');
                }
            };

            const handleCopyARCode = () => {
                const arCode = `040017D0 0000000A
040017D4 00000042
040017B0 5744E608
040017B4 2505317F
040017B8 57EE6EC1
040017BC AA4A994E
040017C0 7E7BF29A`;
                navigator.clipboard.writeText(arCode).then(() => {
                    setStatus('AR Code copied to clipboard');
                });
            };

            return (
                <div className="min-h-screen bg-[#87ceeb] flex items-center justify-center p-4">
                    <div className="flex flex-col items-center w-full max-w-md">
                        <div className="bg-slate-800 rounded-lg shadow-2xl p-8 w-full border border-slate-700">
                            <h1 className="text-3xl font-bold text-white mb-6 text-center">
                                Custom RR RPC Patcher
                            </h1>
                            
                            <div
                                className={`border-2 border-dashed rounded-lg p-8 mb-6 text-center transition-colors ${
                                    dragActive
                                        ? 'border-blue-400 bg-blue-950'
                                        : file
                                        ? 'border-green-400 bg-green-950'
                                        : 'border-slate-600 bg-slate-900'
                                }`}
                                onDragEnter={handleDrag}
                                onDragLeave={handleDrag}
                                onDragOver={handleDrag}
                                onDrop={handleDrop}
                            >
                                <Upload size={48} className="mx-auto mb-4 text-slate-400" />
                                <p className="text-slate-300 mb-2">
                                    {fileName || 'Drag and drop Code.pul'}
                                </p>
                                <p className="text-slate-500 text-sm mb-4">or</p>
                                <label className="cursor-pointer bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded inline-block transition-colors">
                                    Browse Files
                                    <input
                                        type="file"
                                        className="hidden"
                                        onChange={handleFileInput}
                                        accept=".pul"
                                    />
                                </label>
                            </div>

                            <div className="mb-6">
                                <label className="block text-slate-300 mb-2 font-medium flex items-center gap-2">
                                    Application ID
                                    <HelpCircle 
                                        size={16} 
                                        className="text-slate-400 cursor-pointer hover:text-slate-200 transition-colors"
                                        onClick={() => setShowHelp(!showHelp)}
                                        title="what is this?"
                                    />
                                </label>
                                <input
                                    type="text"
                                    value={appId}
                                    onChange={handleAppIdChange}
                                    placeholder="Discord Application ID"
                                    className="w-full px-4 py-3 bg-slate-900 border border-slate-600 rounded text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500"
                                />
                            </div>

                            <button
                                onClick={handlePatch}
                                className="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded transition-colors flex items-center justify-center gap-2 mb-3"
                            >
                                <Download size={20} />
                                Patch
                            </button>

                            <button
                                onClick={handleCopyARCode}
                                className="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 rounded transition-colors flex items-center justify-center gap-2"
                            >
                                Copy AR Code
                            </button>

                            {status && (
                                <div className={`mt-4 p-3 rounded text-sm ${
                                    status.startsWith('âœ“')
                                        ? 'bg-green-900 text-green-200'
                                        : 'bg-red-900 text-red-200'
                                }`}>
                                    {status}
                                </div>
                            )}

                            {showHelp && (
                                <div className="mt-4 p-4 bg-slate-700 border border-slate-600 rounded-lg text-slate-200 text-sm">
                                    <h3 className="font-bold mb-3">instructions</h3>
                                    <ol className="list-decimal list-inside space-y-2">
                                        <li>create an application in the <a href="https://discord.com/developers/applications" target="_blank" rel="noopener noreferrer" className="text-blue-400 hover:text-blue-300 underline">discord dev portal</a> and name it Retro Rewind (or whatever you'd like it to show up as on your profile)</li>
                                        <li>change the app icon to whatever you want to display on your profile</li>
                                        <li>navigate to "Rich Presence" in the side bar then add the image. <strong>make sure it's named image_logo after you add it!</strong></li>
                                        <li>copy the application ID in general settings then use that in the patcher</li>
                                        <li>replace your old code.pul with the patched one</li>
                                        <li>run rr with the ar code (dm me on discord if you can't connect online)</li>
                                    </ol>
                                </div>
                            )}
                        </div>

                        <p className="text-slate-700 text-sm mt-4 text-center">
                            Latest version: 6.5.6-beta 
                        </p>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<HexPatcher />, document.getElementById('root'));
    </script>
</body>
</html>